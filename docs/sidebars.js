/**
 * Creating a sidebar enables you to:
 - create an ordered group of docs
 - render a sidebar for each doc of that group
 - provide next/previous navigation

 The sidebars can be generated from the filesystem, or explicitly defined here.

 Create as many sidebars as you want.
 */

const fs = require("fs");

const Route = require("./route.json");
const langDefault = require("./lang/zh/Route_zh.json");

// @ts-check

/** @type {import('@docusaurus/plugin-content-docs').SidebarsConfig} */
const sidebars = {
  // // By default, Docusaurus generates a sidebar from the docs folder structure
  // tutorialSidebar: [{type: 'autogenerated', dirName: '.'}],
    docs: [],
};

let maxStack = 0;

for (let routeKey in Route) {
    sidebars.docs.push({
        type: "category",
        items: Route[routeKey],
        link: {
            type: 'generated-index',
            slug: `/${routeKey}`,
        },
        label: routeKey in langDefault ? langDefault[routeKey] : routeKey
    });
    if (routeKey.includes("/")) maxStack = Math.max(maxStack, routeKey.split("/").length);
}

for (let i = maxStack; i > 0; i--) {
    for (let perCategory of sidebars.docs) {
        if (perCategory.type != "doc") {
            let categoryKey = getRouteKey(perCategory);
            if (categoryKey.split("/").length == i) {
                for (let category of sidebars.docs) {
                    if ("items" in category) {
                        let index = category.items.indexOf(categoryKey);
                        if (index != -1) {
                            category.items[index] = perCategory;
                            sidebars.docs = sidebars.docs.filter(cate => getRouteKey(cate) != categoryKey);
                        }
                    }
                }
            }
        }

    }
    function getRouteKey(category) {
        console.log(category.link.slug)
        return category.link.slug.slice(1);
    }
}

sidebars.docs.splice(0, 0, { type: "doc", id: "intro", label: "索引" });

fs.writeFileSync("sidebars.json", JSON.stringify(sidebars));

module.exports = sidebars;
